name: Test Action

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test-action:
    name: Test Basic Functionality
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Create test files
        run: |
          echo "version: 1.0.0" > test-version.txt
          echo "timestamp: $(date)" > test-timestamp.txt
          echo "# Test changes for action" >> README.md

      - name: Test the action
        id: test-action
        uses: ./
        with:
          repository_path: .
          commit_message: "Test commit from action"
          user_name: "Test Bot"
          user_email: "test-bot@example.com"
          max_retries: 1

      - name: Check results
        run: |
          echo "Action result: ${{ steps.test-action.outputs.result }}"
          echo "Attempts: ${{ steps.test-action.outputs.attempts }}"

  test-docker:
    name: Test Docker Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build and test Docker image
        run: |
          docker build -t test-action .
          echo "Testing individual tools in container:"
          echo "✅ YQ Version:"
          docker run --rm --entrypoint="" test-action yq --version
          echo "✅ Git Version:"  
          docker run --rm --entrypoint="" test-action git --version
          echo "✅ Bash Version:"
          docker run --rm --entrypoint="" test-action bash --version
          echo "✅ All Docker tools work correctly"