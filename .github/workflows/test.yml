name: Test Action

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test-basic:
    name: Basic Test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup test git repo in workspace
        run: |
          git config user.name "Test User"
          git config user.email "test@example.com"
          echo "# Test File" > test.txt
          echo "version: 1.0.0" >> test.txt

      - name: Test the action
        uses: ./
        with:
          repository_path: .
          commit_message: "Test commit"

      - name: Verify result
        run: |
          echo "âœ… Last commit:"
          git log -1 --oneline

  test-docker:
    name: Test Docker Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build Docker image
        run: docker build -t test-action .

      - name: Test tools in container
        run: |
          docker run --rm test-action yq --version
          docker run --rm test-action git --version